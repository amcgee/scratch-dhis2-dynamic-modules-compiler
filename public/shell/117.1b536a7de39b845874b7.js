(self.webpackChunkshell=self.webpackChunkshell||[]).push([[117],{9117:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CustomDataProvider:()=>$,DataMutation:()=>F,DataProvider:()=>Q,DataQuery:()=>L,Provider:()=>ne,useAlert:()=>re,useAlerts:()=>te,useConfig:()=>c,useDataEngine:()=>q,useDataMutation:()=>_,useDataQuery:()=>V});var n=r(8013),a=r.n(n),o=r(3038),s=r.n(o);const i=s().createContext({baseUrl:"..",apiVersion:32}),c=()=>(0,o.useContext)(i),u=({config:e,children:t})=>s().createElement(i.Provider,{value:e},t);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const h=({resource:e,id:t,data:r,params:n},a)=>({resource:e,id:"function"==typeof t?t(a):t,data:"function"==typeof r?r(a):r,params:"function"==typeof n?n(a):n});class m extends Error{constructor(e){super("Invalid query\n".concat(e.map((e=>" - "+e)).join("\n"))),l(this,"type","invalid-query"),l(this,"details",void 0),this.details=e}}const f=["resource","id","params","data"],y=["read","create","update","replace","delete"],b=(e,t)=>{if(!y.includes(e))return["Unknown query or mutation type ".concat(e)];if("object"!=typeof t)return["A query or mutation must be a javascript object"];const r=[];return t.resource&&"string"==typeof t.resource||r.push("Property resource must be a string"),"create"===e&&t.id&&r.push("Mutation type 'create' does not support property 'id'"),t.id&&"string"!=typeof t.id&&r.push("Property id must be a string"),t.params&&"object"!=typeof t.params&&r.push("Property params must be an object"),"delete"===e&&t.data&&r.push("Mutation type 'delete' does not support property 'data'"),Object.keys(t).filter((e=>!f.includes(e))).forEach((e=>{r.push("Property ".concat(e," is not supported"))})),r};class g{constructor(e){l(this,"link",void 0),this.link=e}query(e,{variables:t={},signal:r,onComplete:n,onError:a}={}){const o=Object.keys(e),s=o.map((t=>e[t])).map((e=>h(e,t)));return((e,t=[])=>{if(t.length!==e.length)for(let r=t.length;r<e.length;++r)t.push("query#"+r);const r=e.reduce(((e,r,n)=>e.concat(b("read",r).map((e=>"[".concat(t[n],"] ").concat(e))))),[]);if(r.length)throw new m(r)})(s,o),Promise.all(s.map((e=>this.link.executeResourceQuery("read",e,{signal:r})))).then((e=>{const t=((e,t)=>e.reduce(((e,r,n)=>(e[t[n]]=r,e)),{}))(e,o);return n&&n(t),t})).catch((e=>{throw a&&a(e),e}))}mutate(e,{variables:t={},signal:r,onComplete:n,onError:a}={}){const o=h(e,t),s=(e=>"update"===e.type?e.partial?"update":"replace":e.type)(e);return((e,t)=>{const r=b(e,t);if(r.length)throw new m(r)})(s,o),this.link.executeResourceQuery(s,o,{signal:r}).then((e=>(n&&n(e),e))).catch((e=>{throw a&&a(e),e}))}}class v extends Error{constructor({message:e,type:t,details:r={}}){super(e),l(this,"type",void 0),l(this,"details",void 0),this.type=t,this.details=r}}class w{constructor(e,{failOnMiss:t=!0,loadForever:r=!1}={}){l(this,"failOnMiss",void 0),l(this,"loadForever",void 0),l(this,"data",void 0),this.data=e,this.failOnMiss=t,this.loadForever=r}async executeResourceQuery(e,t,r){if(this.loadForever)return new Promise((()=>{}));const n=this.data[t.resource];if(!n){if(this.failOnMiss)throw new Error("No data provided for resource type ".concat(t.resource,"!"));return Promise.resolve(null)}switch(typeof n){case"string":case"number":case"boolean":case"object":return n;case"function":{const a=await n(e,t,r);if(void 0===a&&this.failOnMiss)throw new Error("The custom function for resource ".concat(t.resource," must always return a value but returned ").concat(a));return a||null}}}}const O=async e=>{if(401===e.status||403===e.status||409===e.status){let t,r={};try{r=await e.json(),t=r.message}catch(e){}throw t||(t=401===e.status?"Unauthorized":"Forbidden"),new v({type:"access",message:t,details:r})}if(e.status<200||e.status>=400){const t="An unknown error occurred - ".concat(e.statusText," (").concat(e.status,")");let r={};try{r=await e.json()}catch(e){}throw new v({type:"unknown",message:t,details:r})}return e},j=(...e)=>e.filter((e=>!!e)).map((e=>e.replace(/^\/+|\/+$/g,""))).join("/");var C=Object.freeze({__proto__:null,isReplyToMessageConversation:(e,{resource:t})=>"create"===e&&/^messageConversations\/[a-zA-Z0-9]{11}$/.test(t),isCreateFeedbackMessage:(e,{resource:t})=>"create"===e&&"messageConversations/feedback"===t,isCreateOrUpdateInterpretation:(e,{resource:t,id:r})=>{if("create"!==e&&"replace"!==e)return!1;let n;if("replace"===e&&r){n=/^interpretations\/(?:reportTable|chart|visualization|map|eventReport|eventChart|dataSetReport)$/;const e=/^[a-zA-Z0-9]{11}$/;return n.test(t)&&e.test(r)}return n=/^interpretations\/(?:reportTable|chart|visualization|map|eventReport|eventChart|dataSetReport)\/[a-zA-Z0-9]{11}$/,n.test(t)},isCommentOnInterpretation:(e,{resource:t})=>"create"===e&&/^interpretations\/[a-zA-Z0-9]{11}\/comments$/.test(t),isInterpretationCommentUpdate:(e,{resource:t,id:r})=>{if("replace"!==e)return!1;if(r){const e=/^[a-zA-Z0-9]{11}\/comments\/[a-zA-Z0-9]{11}$/,n=/^[a-zA-Z0-9]{11}$/,a=/^interpretations\/[a-zA-Z0-9]{11}\/comments$/;return"interpretations"===t&&e.test(r)||a.test(t)&&n.test(r)}return/^interpretations\/[a-zA-Z0-9]{11}\/comments\/[a-zA-Z0-9]{11}$/.test(t)},isAddOrUpdateSystemOrUserSetting:(e,{resource:t})=>"create"===e&&/^(?:systemSettings|userSettings)\/[a-zA-Z]{4,}$/.test(t),addOrUpdateConfigurationProperty:(e,{resource:t})=>{const r=t.match(/^(configuration)\/([a-zA-Z]{1,50})$/);return"create"===e&&!!r&&"corsWhitelist"!==r[2]},isMetadataPackageInstallation:(e,{resource:t})=>"create"===e&&"synchronization/metadataPull"===t}),P=Object.freeze({__proto__:null,isFileResourceUpload:(e,{resource:t})=>"create"===e&&"fileResources"===t,isMessageConversationAttachment:(e,{resource:t})=>"create"===e&&"messageConversations/attachments"===t,isStaticContentUpload:(e,{resource:t})=>"create"===e&&/^staticContent\/(?:logo_banner|logo_front)$/.test(t),isAppInstall:(e,{resource:t})=>"create"===e&&"apps"===t,isSvgConversion:(e,{resource:t})=>"create"===e&&("svg.png"===t||"svg.pdf"===t)});const E=e=>{if(e&&"multipart/form-data"!==e)return{"Content-Type":e}},k=(e,{data:t})=>{if(void 0!==t)return"application/json"===e?JSON.stringify(t):"multipart/form-data"===e?(e=>{const t=Object.entries(e);if(0===t.length)throw new Error("Could not convert data to FormData: object does not have own enumerable string-keyed properties");return t.reduce(((e,[t,r])=>(e.append(t,r),e)),new FormData)})(t):t},A=e=>{switch(e){case"create":return"POST";case"read":return"GET";case"update":return"PATCH";case"replace":return"PUT";case"delete":return"DELETE"}},z=e=>{if(Array.isArray(e))return e.map(z).join(",");if("string"==typeof e)return encodeURIComponent(e);if("number"==typeof e||"boolean"==typeof e)return String(e);if("object"==typeof e)throw new Error("Object parameter mappings not yet implemented");throw new Error("Unknown parameter type")},x="action::",S=(e,{resource:t,id:r,params:n={}})=>{const a=(e=>e.startsWith(x))(t)?(e=>j("dhis-web-commons","".concat(e.substr(x.length),".action")))(t):j(e,t,r);return Object.keys(n).length?"".concat(a,"?").concat((e=>(e=>Object.keys(e).reduce(((t,r)=>{const n=e[r];return"filter"===r&&Array.isArray(n)?n.forEach((e=>{t.push({key:"filter",value:e})})):null!==e[r]&&void 0!==e[r]&&t.push({key:r,value:e[r]}),t}),[]))(e).map((({key:e,value:t})=>"".concat(encodeURIComponent(e),"=").concat(z(t)))).join("&"))(n)):a};class D{constructor({baseUrl:e,apiVersion:t}){l(this,"apiPath",void 0),l(this,"baseUrl",void 0),l(this,"apiVersion",void 0),this.baseUrl=e,this.apiVersion=t,this.apiPath=j("api",String(t))}fetch(e,t){return function(e,t={}){return fetch(e,d(d({},t),{},{credentials:"include",headers:d({"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},t.headers)})).catch((e=>{throw new v({type:"network",message:"An unknown network error occurred",details:e})})).then(O).then((async e=>{const t=(e=>e?e.split(";")[0].trim().toLowerCase():"")(e.headers.get("Content-Type"));return"application/json"===t?await e.json():/^text\/[a-z0-9.-]+$/.test(t)?await e.text():await e.blob()}))}(j(this.baseUrl,e),t)}executeResourceQuery(e,t,{signal:r}){return this.fetch(S(this.apiPath,t),((e,t,r)=>{const n=((e,t)=>t.data?((e,t)=>Object.values(C).some((r=>r(e,t))))(e,t)?"text/plain":((e,t)=>Object.values(P).some((r=>r(e,t))))(e,t)?"multipart/form-data":"application/json":null)(e,t);return{method:A(e),body:k(n,t),headers:E(n),signal:r}})(e,t,r))}}const R=new class{constructor(e){l(this,"errorMessage",void 0),this.errorMessage=e}executeResourceQuery(){return console.error(this.errorMessage),Promise.reject(this.errorMessage)}}("DHIS2 data context must be initialized, please ensure that you include a <DataProvider> in your application"),M={engine:new g(R)},U=a().createContext(M),$=({children:e,data:t,options:r})=>{const n=new w(t,r),o={engine:new g(n)};return a().createElement(U.Provider,{value:o},e)},T=(e,{warn:t=!1,name:r="input"}={})=>{const a=(0,n.useRef)(e),[o,s]=(0,n.useState)((()=>a.current));return(0,n.useEffect)((()=>{t&&a.current!==e&&console.warn("The ".concat(r," should be static, don't create it within the render loop!"))}),[t,e,a,r]),[o,s]},Z=({execute:e,variables:t,singular:r,immediate:a,onComplete:o,onError:s})=>{const[i]=T(e),[c,u]=(0,n.useState)({called:!!a,loading:!!a}),l=(0,n.useRef)(t),p=(0,n.useRef)([]),h=(0,n.useCallback)((()=>{p.current.forEach((e=>e.abort())),p.current=[]}),[]),m=(0,n.useCallback)((()=>{h(),u((e=>({called:e.called,loading:!1,error:new v({type:"aborted",message:"Aborted"})})))}),[h]),f=(0,n.useCallback)(((e={})=>{u((e=>e.called&&e.loading?e:{called:!0,loading:!0})),r&&h();const t=new AbortController;p.current.push(t),l.current=d(d({},l.current),e);const n={variables:l.current,signal:t.signal,onComplete:o,onError:s};return i(n).then((e=>t.signal.aborted?new Promise((()=>{})):(u({called:!0,loading:!1,data:e}),e))).catch((e=>(t.signal.aborted||u({called:!0,loading:!1,error:e}),new Promise((()=>{})))))}),[h,o,s,r,i]);return(0,n.useEffect)((()=>(a&&f(),h)),[]),d({refetch:f,abort:m},c)},q=()=>(0,n.useContext)(U).engine,I={},_=(e,{onComplete:t,onError:r,variables:a=I,lazy:o=!0}={})=>{const s=q(),[i]=T(e,{warn:!0,name:"mutation"}),c=(0,n.useCallback)((e=>s.mutate(i,e)),[s,i]),{refetch:u,called:l,loading:p,error:d,data:h}=Z({execute:c,variables:a,singular:!1,immediate:!o,onComplete:t,onError:r});return[u,{engine:s,called:l,loading:p,error:d,data:h}]},F=({mutation:e,onComplete:t,onError:r,variables:n,children:a})=>a(_(e,{onComplete:t,onError:r,variables:n})),Q=e=>{const t=d(d({},c()),e),r=new D(t),n={engine:new g(r)};return a().createElement(U.Provider,{value:n},e.children)},H={},V=(e,{onComplete:t,onError:r,variables:a=H,lazy:o=!1}={})=>{const s=q(),[i]=T(e,{warn:!0,name:"query"}),c=(0,n.useCallback)((e=>s.query(i,e)),[s,i]),{refetch:u,called:l,loading:p,error:d,data:h}=Z({execute:c,variables:a,singular:!0,immediate:!o,onComplete:t,onError:r});return{engine:s,refetch:u,called:l,loading:p,error:d,data:h}},L=({query:e,onComplete:t,onError:r,variables:n,lazy:a,children:o})=>o(V(e,{onComplete:t,onError:r,variables:n,lazy:a})),N=s().createContext([]),W=()=>{},X={remove:W,add:W},G=s().createContext(X);function J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){J(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Y=(e,t,r)=>K(K({},e),{},{id:t,remove:()=>r(t)}),ee=({children:e})=>{const[t,r]=(0,o.useState)([]),[n]=(0,o.useState)((()=>(e=>{let t=0;const r=t=>{e((e=>e.filter((e=>e.id!==t))))};return{remove:r,add:n=>{e((e=>[...e,Y(n,++t,r)]))}}})(r)));return s().createElement(G.Provider,{value:n},s().createElement(N.Provider,{value:t},e))},te=()=>(0,o.useContext)(N),re=(e,t={})=>{const r=(0,o.useContext)(G);return{show:n=>{const a={message:String("function"==typeof e?e(n):e),options:"function"==typeof t?t(n):t};r.add(a)}}},ne=({config:e,children:t})=>s().createElement(u,{config:e},s().createElement(ee,null,s().createElement(Q,null,t)));ne.displayName="DHIS2RuntimeProvider"}}]);
//# sourceMappingURL=117.1b536a7de39b845874b7.js.map